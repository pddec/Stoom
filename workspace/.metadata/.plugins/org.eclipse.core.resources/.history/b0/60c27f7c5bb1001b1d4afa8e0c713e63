package br.com.stoom.CRUD.services;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import br.com.stoom.CRUD.dto.AddressDTO;
import br.com.stoom.CRUD.dto.AddressDTO.BuilderAddressDTO;
import br.com.stoom.CRUD.models.Address;
import br.com.stoom.CRUD.repositories.AddressRepository;
import br.com.stoom.CRUD.services.interfaces.CallServices;
import br.com.stoom.CRUD.services.interfaces.Services;

@Service
public class AddressService implements Services<AddressDTO> {
	
	@Autowired
	AddressRepository addressRepository;
	
	@Autowired
	CallServices<AddressDTO> googleMapCallService;

	@Override
	public void executeGet(AddressDTO dto) {
		
		Address addressModel;
		
		if(dto.getLatitude() == null && dto.getLongitude() == null) {
			googleMapCallService.execute(response -> 
					BuilderAddressDTO.create()
					.setId(dto.getId())
					.setCity(dto.getCity())
					.setComplement(dto.getComplement())
					.setCountry(dto.getCountry())
					.setNeighbourhood(dto.getNeighbourhood())
					.setNumber(dto.getNumber())
					.setStreetName(dto.getStreetName())
					.setState(dto.getState())
					.setZipcode(dto.getZipcode())
					.setLatitude(response.get("latitude"))
					.setLongitude(response.get("longitude"))
					.build());
		}
		
		addressModel = new Address(dto);
		addressRepository.save(addressModel);
		
	}

}
